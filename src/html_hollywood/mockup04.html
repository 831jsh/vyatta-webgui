<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
		<title>Vyatta WebGUI</title>
		<style type="text/css">
			body {
				margin:0;
				padding:0;
			}
			#toggle {
			    text-align: center;
			    padding: 1em;
			}
			#toggle a {
			    padding: 0 5px;
			    border-left: 1px solid black;
			}
		</style>

		<link rel="stylesheet" type="text/css" href="yui/build/reset-fonts-grids/reset-fonts-grids.css" />
		<link rel="stylesheet" type="text/css" href="yui/build/resize/assets/skins/sam/resize.css" />
		<link rel="stylesheet" type="text/css" href="yui/build/layout/assets/skins/sam/layout.css" />
		<link rel="stylesheet" type="text/css" href="yui/build/button/assets/skins/sam/button.css" />
		<link rel="stylesheet" type="text/css" href="yui/build/container/assets/skins/sam/container.css">
		<link rel="stylesheet" type="text/css" href="yui/build/treeview/assets/skins/sam/treeview.css">
		<link rel="stylesheet" type="text/css" href="yui/build/logger/assets/skins/sam/logger.css" />
		<link rel="stylesheet" type="text/css" href="loginform.css">


		<script type="text/javascript" src="yui/build/yahoo/yahoo-min.js"></script>
		<script type="text/javascript" src="yui/build/event/event-min.js"></script>
		<script type="text/javascript" src="yui/build/dom/dom-min.js"></script>

		<script type="text/javascript" src="yui/build/logger/logger-min.js"></script>

		<script type="text/javascript" src="yui/build/element/element-beta-debug.js"></script>
		<script type="text/javascript" src="yui/build/button/button-min.js"></script>
		<script type="text/javascript" src="yui/build/dragdrop/dragdrop-min.js"></script>
		<script type="text/javascript" src="yui/build/resize/resize-beta-min.js"></script>
		<script type="text/javascript" src="yui/build/animation/animation-min.js"></script>
		<script type="text/javascript" src="yui/build/layout/layout-beta-min.js"></script>
		<script type="text/javascript" src="yui/build/container/container-min.js"></script>
		<script type="text/javascript" src="yui/build/connection/connection-min.js"></script>
		<script type="text/javascript" src="yui/build/treeview/treeview-debug.js"></script>


		<script type="text/javascript" src="vyatta_webgui.js"></script>


		<script type="text/javascript">

			(function() {
				var Dom = YAHOO.util.Dom, Event = YAHOO.util.Event;

				Event.onDOMReady(function() {

					YAHOO.vyatta.webgui.leftpane = { position: 'left', width: 300, resize: true, body: 'left1', gutter: '0px', scroll: true, animate: true };

					YAHOO.vyatta.webgui.layout = new YAHOO.widget.Layout({
						units: [
							{ position: 'top', height: 71, body: 'top1', gutter: '0px' },
							{ position: 'center', body: 'center1'},
							YAHOO.vyatta.webgui.leftpane
						]
					});


					YAHOO.vyatta.webgui.layout.on('render', function() {
					});
					YAHOO.vyatta.webgui.layout.render();

					YAHOO.vyatta.webgui.layout.getUnitByPosition('left').close();
//					YAHOO.vyatta.webgui.layout.addUnit(YAHOO.vyatta.webgui.leftpane);


					YAHOO.vyatta.webgui.loginPanel = new YAHOO.widget.Panel("loginPanel", {constraintoviewport: true, close: false, draggable: false, fixedcenter: true, underlay: "shadow", width: "320px"});
					YAHOO.vyatta.webgui.loginPanel.render();


					var yuiLogin = new YAHOO.widget.Button("btLogin", {
						disabled:false,
						onclick: {
							fn: YAHOO.vyatta.webgui.doLogin
						}
					});

//					var logger = new YAHOO.widget.LogReader();

				});
			})();

			YAHOO.vyatta.webgui.doLogin = function() {
				var successHandler = function(o) {
					if (o.responseXML != null && o.responseXML.documentElement != null && o.responseXML.documentElement.childNodes != null) {
						for (var i = 0; i < o.responseXML.documentElement.childNodes.length; i++) {
							if (o.responseXML.documentElement.childNodes[i].nodeName == "id") {
								if (o.responseXML.documentElement.childNodes[i].childNodes != null && o.responseXML.documentElement.childNodes[i].childNodes.length == 1) {

									if (o.responseXML.documentElement.childNodes[i].childNodes[0].nodeValue != null) {
										YAHOO.vyatta.webgui.session_id = o.responseXML.documentElement.childNodes[i].childNodes[0].nodeValue;
									}
								}
							}
						}
					} else {
						alert("Server communication error.  Did not receive an XML response.");
					}

					if (YAHOO.vyatta.webgui.session_id != null) {
						YAHOO.vyatta.webgui.loginPanel.hide();
						YAHOO.vyatta.webgui.layout.addUnit(YAHOO.vyatta.webgui.leftpane);

						YAHOO.vyatta.webgui.tree = new YAHOO.widget.TreeView("treeDiv");
						function loadData(n, onCompleteCallback) {
							var vn = new YAHOO.vyatta.webgui.VyattaNodes(n);
							vn.createChildrenTreeNodes(onCompleteCallback);
							n.vn = vn;
						}
						YAHOO.vyatta.webgui.tree.setDynamicLoad(loadData);

						var root = YAHOO.vyatta.webgui.tree.getRoot();
						var cfg = new YAHOO.widget.TextNode("Configure", root);
						YAHOO.vyatta.webgui.tree.draw();

						YAHOO.vyatta.webgui.tree.subscribe("collapseComplete", function(node) {
							YAHOO.vyatta.webgui.tree.removeChildren(node);
						});
						YAHOO.vyatta.webgui.tree.subscribe("labelClick", function(node) {
							document.getElementById("addressLabel").innerHTML = YAHOO.vyatta.webgui.VyattaUtil.getConfigPath(node);
							document.getElementById("configFields").innerHTML = YAHOO.vyatta.webgui.VyattaUtil.generateHtmlLeafs(node);
						});
						cfg.expand();
					}
				}
				var failureHandler = function(o) {
					alert("Server communication error.  Error code: " + o.status + "  Description: " + o.statusText);
				}
				var callback = {
					success: successHandler,
					failure: failureHandler
				};

				var user = document.getElementById("user").value;
				var pswd = document.getElementById("pswd").value;
				var transaction = YAHOO.util.Connect.asyncRequest("POST", "/cgi-bin/webgui_wrapper.cgi", callback, "<vyatta><auth><user>" + user + "</user><pswd>" + pswd + "</pswd></auth></vyatta>\n");
			}
		</script>

	</head>

	<body class="yui-skin-sam">
		<div id="top1" style="background-color: #6294c7; border: 0px; padding: 0px; margin: 0px; height: 71px;">
			<img src="/masthead.jpg" style="border: 0px; padding: 0px;" alt="">
		</div>
		<div id="left1">
			<div id="treeDiv"></div>
		</div>
		<div id="center1">
			<div id="loginPanel">
				<div class="hd">Please login</div>
				<div class="bd">
					<div class="loginformdiv">
						<label>Username:&nbsp;</label>
						<input class="field" type="text" id="user" name="user" />
					</div>
					<div class="loginformdiv">
						<label>Password:&nbsp;</label>
						<input class="field" type="password" id="pswd" name="pswd" />
					</div>
					<div id="buttons">
						<button type="submit" id="btLogin" name="btLogin">Login</button>
					</div>
				</div>
			</div>
			<div id="configPanel">
				<label id="addressLabel" style="margin: 20px; color: blue;" />
				<div id="configFields" style="margin: 20px; color: blue;" />
			</div>
		</div>
	</body>
</html>

